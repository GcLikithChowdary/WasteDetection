<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Waste Management</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <style>
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .output {
      margin-top: 20px;
    }
    #canvas {
      border: 1px solid black;
      max-width: 500px;
      width: 100%;
    }
    img {
      max-width: 500px;
      width: 100%;
    }
    .category {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI-Powered Waste Management</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <img id="image" style="display:none;">
    <canvas id="canvas"></canvas>
    <div id="results" class="output"></div>
  </div>

  <script>
    document.getElementById('imageUpload').addEventListener('change', handleImageUpload);

    // Define categories and their rewards/disposal instructions
    const categories = {
      recyclable: {
        reward: "5 Reward Points",
        disposal: "Place in the recycling bin.",
      },
      nonRecyclable: {
        reward: "2 Reward Points",
        disposal: "Place in the general waste bin.",
      },
      hazardous: {
        reward: "10 Reward Points",
        disposal: "Dispose of at a hazardous waste facility.",
      },
      compostable: {
        reward: "3 Reward Points",
        disposal: "Place in the compost bin.",
      },
      electronic: {
        reward: "8 Reward Points",
        disposal: "Take to an e-waste recycling center.",
      },
    };

    async function handleImageUpload(event) {
      const image = document.getElementById('image');
      const canvas = document.getElementById('canvas');
      const results = document.getElementById('results');
      const file = event.target.files[0];
      const reader = new FileReader();

      reader.onload = function() {
        image.src = reader.result;
        image.onload = async function() {
          // Resize canvas to match image dimensions
          const scale = image.width > 500 ? 500 / image.width : 1;
          canvas.width = image.width * scale;
          canvas.height = image.height * scale;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

          // Perform object detection
          const cocoSsdModel = await cocoSsd.load();
          const detection = await cocoSsdModel.detect(image);
          processDetections(detection, ctx, scale);
        };
      };
      reader.readAsDataURL(file);
    }

    function processDetections(detections, ctx, scale) {
      const resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = ''; // Clear previous results

      detections.forEach(item => {
        const category = classifyObject(item.class);
        const reward = categories[category].reward;
        const disposal = categories[category].disposal;

        // Draw bounding box and label
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        ctx.strokeRect(item.bbox[0] * scale, item.bbox[1] * scale, item.bbox[2] * scale, item.bbox[3] * scale);
        ctx.font = '16px Arial';
        ctx.fillStyle = 'red';
        ctx.fillText(`${item.class} (${category})`, item.bbox[0] * scale, item.bbox[1] * scale > 10 ? item.bbox[1] * scale - 5 : 10);

        // Display structured results
        const section = document.createElement('div');
        section.className = 'category';
        section.innerHTML = `
          <h2>${item.class}</h2>
          <p><strong>Category:</strong> ${category}</p>
          <p><strong>Reward:</strong> ${reward}</p>
          <p><strong>Disposal Instructions:</strong> ${disposal}</p>
        `;
        resultsContainer.appendChild(section);
      });
    }

    function classifyObject(objectName) {
      // Convert object name to lowercase for case-insensitive matching
      objectName = objectName.toLowerCase();

      // Define items for each category
      const recyclableItems = ['bottle', 'can', 'paper', 'cardboard', 'glass', 'metal', 'plastic'];
      const hazardousItems = ['battery', 'chemical', 'paint', 'oil', 'solvent', 'thermometer'];
      const compostableItems = ['apple', 'banana', 'vegetable', 'fruit', 'leaves', 'grass'];
      const electronicItems = ['phone', 'laptop', 'computer', 'tv', 'monitor', 'printer'];
      const nonRecyclableItems = ['styrofoam', 'ceramic', 'light bulb', 'cigarette', 'diaper'];

      if (recyclableItems.includes(objectName)) {
        return 'recyclable';
      } else if (hazardousItems.includes(objectName)) {
        return 'hazardous';
      } else if (compostableItems.includes(objectName)) {
        return 'compostable';
      } else if (electronicItems.includes(objectName)) {
        return 'electronic';
      } else if (nonRecyclableItems.includes(objectName)) {
        return 'nonRecyclable';
      } else {
        return 'nonRecyclable'; // Default category
      }
    }
  </script>
</body>
</html>